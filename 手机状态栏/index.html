<head><meta name="viewport" content="width=device-width,initial-scale=1"/><script type="module">var e={262:(e,t)=>{t.A=(e,t)=>{const a=e.__vccOpts||e;for(const[e,o]of t)a[e]=o;return a}}},t={};const a=Vue,o=z,n=o.z.object({name:o.z.string().default('未知角色'),avatar:o.z.string().optional(),description:o.z.string().optional()}),r=o.z.object({hp:o.z.number().optional(),maxHp:o.z.number().optional(),mp:o.z.number().optional(),maxMp:o.z.number().optional(),mood:o.z.string().optional(),location:o.z.string().optional(),time:o.z.string().optional(),weather:o.z.string().optional(),custom:o.z.record(o.z.string(),o.z.any()).optional()}),s=o.z.object({role:o.z.enum(['user','assistant','system']),content:o.z.string(),timestamp:o.z.number().optional()});o.z.object({time:o.z.string(),battery:o.z.number().min(0).max(100),signal:o.z.number().min(0).max(5),wifi:o.z.boolean()});async function c(){try{const e=getCharData('current');return e?n.parse({name:e.name||'未知角色',avatar:e.avatar||void 0,description:e.description||void 0}):(console.warn('未找到当前角色'),n.parse({}))}catch(e){return console.error('获取角色信息失败:',e),n.parse({})}}function l(e){return e?(e.startsWith('http://')||e.startsWith('https://')||e.startsWith('data:'),e):'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"%3E%3Ccircle cx="50" cy="50" r="50" fill="%23ddd"/%3E%3Ctext x="50" y="50" text-anchor="middle" dy=".3em" font-size="50" fill="%23999"%3E?%3C/text%3E%3C/svg%3E'}function i(e){const t={},a={hp:/<(?:hp|HP|生命值)>(\d+)(?:\/(\d+))?<\/(?:hp|HP|生命值)>/i,mp:/<(?:mp|MP|魔法值|法力值)>(\d+)(?:\/(\d+))?<\/(?:mp|MP|魔法值|法力值)>/i,mood:/<(?:mood|心情|情绪)>(.*?)<\/(?:mood|心情|情绪)>/i,location:/<(?:location|位置|地点)>(.*?)<\/(?:location|位置|地点)>/i,time:/<(?:time|时间)>(.*?)<\/(?:time|时间)>/i,weather:/<(?:weather|天气)>(.*?)<\/(?:weather|天气)>/i},o=e.match(a.hp);o&&(t.hp=parseInt(o[1],10),o[2]&&(t.maxHp=parseInt(o[2],10)));const n=e.match(a.mp);n&&(t.mp=parseInt(n[1],10),n[2]&&(t.maxMp=parseInt(n[2],10))),['mood','location','time','weather'].forEach(o=>{const n=e.match(a[o]);n&&(t[o]=n[1].trim())});const s=/<(\w+)>(.*?)<\/\1>/g,c={};let l;for(;null!==(l=s.exec(e));){const e=l[1].toLowerCase();['hp','mp','mood','location','time','weather','生命值','魔法值','法力值','心情','情绪','位置','地点','天气'].includes(e)||(c[e]=l[2].trim())}return Object.keys(c).length>0&&(t.custom=c),r.parse(t)}async function m(e=10){try{const t=getCurrentMessageId(),a=getChatMessages(t);if(a&&a.length>0){const e=(a[0].message||'').match(/<ALL>([\s\S]*?)<\/ALL>/i);if(e){const t=e[1];console.log('✅ 从当前消息的 <ALL> 标签中提取数据');const a=i(t);return r.parse(a)}}const o=getChatMessages('0-{{lastMessageId}}');if(!o||0===o.length)return r.parse({});const n=o.slice(-e).reverse();let s={};for(const e of n){const t=e.message||'',a=t.match(/<ALL>([\s\S]*?)<\/ALL>/i),o=i(a?a[1]:t);s={hp:s.hp??o.hp,maxHp:s.maxHp??o.maxHp,mp:s.mp??o.mp,maxMp:s.maxMp??o.maxMp,mood:s.mood??o.mood,location:s.location??o.location,time:s.time??o.time,weather:s.weather??o.weather,custom:{...o.custom,...s.custom}}}return r.parse(s)}catch(e){return console.error('获取角色状态失败:',e),r.parse({})}}function p(){const e=(0,a.ref)({name:'加载中...'}),t=(0,a.ref)({}),o=(0,a.ref)([]);let n=null;async function r(){try{const[a,n]=await Promise.all([c(),m()]);e.value=a,t.value=n,await async function(){try{const e=getChatMessages('0-{{lastMessageId}}');if(!e||0===e.length)return void(o.value=[]);const t=e.slice(-3).map(e=>s.parse({role:e.role,content:e.message||'',timestamp:Date.now()}));o.value=t}catch(e){console.error('更新聊天消息失败:',e),o.value=[]}}()}catch(e){console.error('更新数据失败:',e)}}return{characterInfo:e,characterStatus:t,recentMessages:o,updateData:r,startAutoUpdate:function(e=5e3){r(),n&&clearInterval(n),n=window.setInterval(()=>{r()},e)},stopAutoUpdate:function(){n&&(clearInterval(n),n=null)}}}const u={class:'game-status-card'},d={class:'avatar-section'},v={class:'avatar-frame'},f=['src','alt'],h={key:0,class:'level-badge'},g={class:'status-section'},y={class:'character-name'},x={key:0,class:'character-mood'},k={key:1,class:'stat-bar hp-bar'},E={class:'bar-container'},V={class:'bar-text'},w={key:2,class:'stat-bar mp-bar'},N={class:'bar-container'},b={class:'bar-text'},C={class:'extra-section'},M={key:0,class:'info-item'},B={key:1,class:'info-item'},S={key:2,class:'info-item'},D={key:3,class:'tags-compact'},A={class:'tag-key'},I=(0,a.defineComponent)({__name:'App',setup(e){const{characterInfo:t,characterStatus:o,recentMessages:n,updateData:r,startAutoUpdate:s,stopAutoUpdate:c}=p(),i=(0,a.computed)(()=>{if(!o.value.hp)return 0;const e=o.value.maxHp||100;return Math.min(100,Math.max(0,o.value.hp/e*100))}),m=(0,a.computed)(()=>{if(!o.value.mp)return 0;const e=o.value.maxMp||100;return Math.min(100,Math.max(0,o.value.mp/e*100))}),I=(0,a.computed)(()=>{const e=['hp','maxHp','mp','maxMp','mood','location','time','weather','level','等级'],t={};return Object.entries(o.value).forEach(([a,o])=>{e.includes(a)||void 0===o||(t[a]=o)}),t}),L=(0,a.computed)(()=>Object.keys(I.value).length>0);function H(e){return Array.isArray(e)?e.join(' | '):String(e)}return(0,a.onMounted)(()=>{s(5e3)}),(0,a.onUnmounted)(()=>{c()}),(e,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',u,[(0,a.createCommentVNode)(' 左侧：头像区 '),(0,a.createElementVNode)('div',d,[(0,a.createElementVNode)('div',v,[(0,a.createElementVNode)('img',{src:(0,a.unref)(l)((0,a.unref)(t).avatar),alt:(0,a.unref)(t).name,class:'avatar'},null,8,f),(0,a.unref)(o).等级||(0,a.unref)(o).level?((0,a.openBlock)(),(0,a.createElementBlock)('div',h,' Lv.'+(0,a.toDisplayString)((0,a.unref)(o).等级||(0,a.unref)(o).level),1)):(0,a.createCommentVNode)('v-if',!0)])]),(0,a.createCommentVNode)(' 中间：状态区 '),(0,a.createElementVNode)('div',g,[(0,a.createElementVNode)('div',y,(0,a.toDisplayString)((0,a.unref)(t).name),1),(0,a.unref)(o).mood?((0,a.openBlock)(),(0,a.createElementBlock)('div',x,(0,a.toDisplayString)((0,a.unref)(o).mood),1)):(0,a.createCommentVNode)('v-if',!0),(0,a.createCommentVNode)(' HP条 '),void 0!==(0,a.unref)(o).hp?((0,a.openBlock)(),(0,a.createElementBlock)('div',k,[n[0]||(n[0]=(0,a.createElementVNode)('span',{class:'stat-icon'},'❤️',-1)),(0,a.createElementVNode)('div',E,[(0,a.createElementVNode)('div',{class:'bar-fill hp-fill',style:(0,a.normalizeStyle)({width:i.value+'%'})},null,4),(0,a.createElementVNode)('span',V,(0,a.toDisplayString)((0,a.unref)(o).hp)+'/'+(0,a.toDisplayString)((0,a.unref)(o).maxHp||100),1)])])):(0,a.createCommentVNode)('v-if',!0),(0,a.createCommentVNode)(' MP条 '),void 0!==(0,a.unref)(o).mp?((0,a.openBlock)(),(0,a.createElementBlock)('div',w,[n[1]||(n[1]=(0,a.createElementVNode)('span',{class:'stat-icon'},'💙',-1)),(0,a.createElementVNode)('div',N,[(0,a.createElementVNode)('div',{class:'bar-fill mp-fill',style:(0,a.normalizeStyle)({width:m.value+'%'})},null,4),(0,a.createElementVNode)('span',b,(0,a.toDisplayString)((0,a.unref)(o).mp)+'/'+(0,a.toDisplayString)((0,a.unref)(o).maxMp||100),1)])])):(0,a.createCommentVNode)('v-if',!0)]),(0,a.createCommentVNode)(' 右侧：扩展信息 '),(0,a.createElementVNode)('div',C,[(0,a.unref)(o).location?((0,a.openBlock)(),(0,a.createElementBlock)('div',M,'📍 '+(0,a.toDisplayString)((0,a.unref)(o).location),1)):(0,a.createCommentVNode)('v-if',!0),(0,a.unref)(o).time?((0,a.openBlock)(),(0,a.createElementBlock)('div',B,'🕐 '+(0,a.toDisplayString)((0,a.unref)(o).time),1)):(0,a.createCommentVNode)('v-if',!0),(0,a.unref)(o).weather?((0,a.openBlock)(),(0,a.createElementBlock)('div',S,'🌤️ '+(0,a.toDisplayString)((0,a.unref)(o).weather),1)):(0,a.createCommentVNode)('v-if',!0),(0,a.createCommentVNode)(' 捕获的标签（紧凑显示） '),L.value?((0,a.openBlock)(),(0,a.createElementBlock)('div',D,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(I.value,(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:t,class:'tag-chip'},[(0,a.createElementVNode)('span',A,(0,a.toDisplayString)(t),1),(0,a.createTextVNode)(': '+(0,a.toDisplayString)(H(e)),1)]))),128))])):(0,a.createCommentVNode)('v-if',!0)])]))}});var L=function a(o){var n=t[o];if(void 0!==n)return n.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,a),r.exports}(262);const H=(0,L.A)(I,[['__scopeId','data-v-2949d9be']]);$(()=>{(0,a.createApp)(H).mount('#app'),toastr.success('手机状态栏已加载','欢迎')}),$(window).on('pagehide',()=>{toastr.info('手机状态栏已卸载','再见')});</script><style>.game-status-card[data-v-2949d9be]{display:flex;align-items:stretch;width:100%;max-width:600px;height:120px;margin:0;background:linear-gradient(135deg,#1a1a2e 0%,#0f0f1e 100%);border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,.6);border:2px solid rgba(255,215,0,.3);overflow:hidden;font-size:11px}.avatar-section[data-v-2949d9be]{flex-shrink:0;width:120px;background:linear-gradient(135deg,rgba(255,215,0,0.15) 0%,rgba(255,215,0,0.05) 100%);display:flex;align-items:center;justify-content:center;border-right:2px solid rgba(255,215,0,.3);padding:10px}.avatar-section .avatar-frame[data-v-2949d9be]{position:relative;width:80px;height:80px}.avatar-section .avatar-frame .avatar[data-v-2949d9be]{width:100%;height:100%;border-radius:50%;object-fit:cover;border:3px solid gold;box-shadow:0 0 20px rgba(255,215,0,.6)}.avatar-section .avatar-frame .level-badge[data-v-2949d9be]{position:absolute;bottom:-5px;right:-5px;background:linear-gradient(135deg,#ff6b6b 0%,#ee5a6f 100%);color:#fff;padding:3px 8px;border-radius:10px;font-size:10px;font-weight:700;border:2px solid #0f0f1e;box-shadow:0 2px 8px rgba(255,107,107,.5)}.status-section[data-v-2949d9be]{flex:1;padding:12px 15px;display:flex;flex-direction:column;justify-content:center;gap:6px}.status-section .character-name[data-v-2949d9be]{font-size:16px;font-weight:700;color:gold;text-shadow:0 1px 4px rgba(255,215,0,.5);margin-bottom:2px}.status-section .character-mood[data-v-2949d9be]{font-size:10px;color:#a0a0ff;font-style:italic;margin-bottom:4px}.status-section .stat-bar[data-v-2949d9be]{display:flex;align-items:center;gap:6px;margin-bottom:4px}.status-section .stat-bar .stat-icon[data-v-2949d9be]{font-size:12px;flex-shrink:0}.status-section .stat-bar .bar-container[data-v-2949d9be]{position:relative;flex:1;height:16px;background:rgba(0,0,0,.6);border-radius:8px;overflow:hidden;border:1px solid hsla(0,0%,100%,.15);box-shadow:inset 0 2px 4px rgba(0,0,0,.5)}.status-section .stat-bar .bar-container .bar-fill[data-v-2949d9be]{position:absolute;left:0;top:0;height:100%;transition:width .5s ease;border-radius:7px}.status-section .stat-bar .bar-container .hp-fill[data-v-2949d9be]{background:linear-gradient(90deg,#ff4757 0%,#ff6348 100%);box-shadow:0 0 10px rgba(255,71,87,.6);animation:pulse-2949d9be 2s ease-in-out infinite}.status-section .stat-bar .bar-container .mp-fill[data-v-2949d9be]{background:linear-gradient(90deg,#5f27cd 0%,#341f97 100%);box-shadow:0 0 10px rgba(95,39,205,.6);animation:pulse-2949d9be 2s ease-in-out infinite}.status-section .stat-bar .bar-container .bar-text[data-v-2949d9be]{position:relative;z-index:1;text-align:center;line-height:14px;font-size:9px;font-weight:700;color:#fff;text-shadow:0 1px 2px #000}.extra-section[data-v-2949d9be]{flex-shrink:0;width:180px;background:rgba(0,0,0,.2);border-left:1px solid rgba(255,215,0,.2);padding:10px;display:flex;flex-direction:column;gap:4px;overflow-y:auto}.extra-section[data-v-2949d9be]::-webkit-scrollbar{width:3px}.extra-section[data-v-2949d9be]::-webkit-scrollbar-thumb{background:rgba(255,215,0,.3);border-radius:2px}.extra-section .info-item[data-v-2949d9be]{font-size:9px;color:#ddd;padding:3px 6px;background:rgba(0,0,0,.3);border-radius:4px;border:1px solid rgba(255,215,0,.2)}.extra-section .tags-compact[data-v-2949d9be]{display:flex;flex-direction:column;gap:3px;margin-top:4px}.extra-section .tags-compact .tag-chip[data-v-2949d9be]{font-size:8px;color:#fff;padding:3px 5px;background:linear-gradient(135deg,#2c3e50 0%,#34495e 100%);border-radius:4px;border:1px solid rgba(255,215,0,.2)}.extra-section .tags-compact .tag-chip .tag-key[data-v-2949d9be]{color:gold;font-weight:700;text-transform:uppercase}@keyframes pulse-2949d9be{0%,100%{filter:brightness(1)}50%{filter:brightness(1.1)}}
:root{--phone-width:375px;--phone-bg:#000;--screen-bg:#fff;--notch-height:30px;--status-bar-height:44px;--border-radius:36px}*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#app{width:100%;display:flex;justify-content:center;align-items:flex-start;padding:20px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:600px}.phone-frame{width:var(--phone-width);aspect-ratio:375/812;background:var(--phone-bg);border-radius:var(--border-radius);padding:12px;box-shadow:0 0 0 2px #1a1a1a,0 0 0 4px #2a2a2a,0 20px 60px rgba(0,0,0,.5);position:relative;overflow:hidden}.phone-frame .phone-screen{width:100%;height:100%;background:var(--screen-bg);border-radius:calc(var(--border-radius) - 12px);overflow:hidden;position:relative;display:flex;flex-direction:column}.phone-frame .notch{position:absolute;top:0;left:50%;transform:translateX(-50%);width:180px;height:var(--notch-height);background:var(--phone-bg);border-radius:0 0 20px 20px;z-index:100}.phone-frame .notch::before{content:"";position:absolute;top:10px;left:50%;transform:translateX(-50%);width:60px;height:6px;background:#333;border-radius:3px}.phone-frame .notch::after{content:"";position:absolute;top:8px;right:30px;width:10px;height:10px;background:#1a1a1a;border-radius:50%;box-shadow:inset 0 0 3px rgba(0,100,255,.8)}.phone-frame::before{content:"";position:absolute;left:-2px;top:100px;width:3px;height:30px;background:#1a1a1a;border-radius:2px 0 0 2px}.phone-frame::after{content:"";position:absolute;right:-2px;top:120px;width:3px;height:60px;background:#1a1a1a;border-radius:0 2px 2px 0}@media (max-width:768px){#app{padding:10px}.phone-frame{width:min(var(--phone-width),100%)}}
</style></head><body><div id="app"></div></body>